# Цели

* Писать на Julia кратко, читаемо, производительно.
* Для задач расчета моделей месторождений использовать JutulDarcy.jl.
* Примеры и шаблоны брать из официальных страниц JutulDarcy:
  [https://sintefmath.github.io/JutulDarcy.jl/stable/man/intro](https://sintefmath.github.io/JutulDarcy.jl/stable/man/intro)

# Как отвечать

1. Сначала **готовый минимальный код** (точечные правки, без переписывания файла целиком).
2. Затем **2–3 тезиса** с пояснениями и допущениями.
3. В конце **минимальная проверка**: как запустить и какой ожидаемый вывод/размерности.

# Уровень сложности (жёсткие пределы)

* По умолчанию решение укладывается в **≤ 30 строк** кода на задачу.
* Если нужно больше — разбить на маленькие функции, каждая ≤ 15 строк.
* Запрещено вводить новые публичные типы/функции без явной необходимости.
* Не трогать рабочие части, не относящиеся к багу/фиче.

# Правила кода (Julia)

* Стиль: BlueStyle/JuliaFormatter; 4 пробела; строки ≤ 92 символов.
* Без глобальных изменяемых переменных; логика — внутри функций.
* Следить за типовой стабильностью и выделениями памяти.
* Публичные функции/типы — короткая докстрока + один простой пример.

# Проект и окружение

* Работать в активном окружении (`Project.toml/Manifest.toml`), Julia ≥ 1.9.
* Импорты построчно: `using Модуль`, без «звёздочек».
* Новые зависимости — только по согласованию.

# JutulDarcy — базовый шаблон

* Сетка/коллектор (`CartesianMesh`, `reservoir_domain`), скважины (`setup_*well`).
* Система фаз (`ImmiscibleSystem` или другая по задаче).
* Модель + параметры (`setup_reservoir_model`), начальное состояние.
* Управление и шаги времени (`forces`, `dt`), запуск `simulate_reservoir(...)`.
* Если нужен пример — адаптировать «Your first JutulDarcy simulation» по ссылке выше.

# Тестирование (обязательно в каждом ответе)

* Локальные проверки через `Test`/`@testitem` **или** мини-скрипт с печатью ключевых чисел.
* Любые ускорители и альтернативные бэкенды подключать **только по моему запросу**.

# Шаблон ответа

1. **Код** (только изменённые фрагменты или компактный модуль).
2. **Пояснения (2–3 пункта)**: что исправлено/сделано, какие допущения.
3. **Проверка**:

   * Команда(ы) запуска.
   * Ожидаемые ключевые числа/размерности (первые 1–2 значения).
   * Критерий успеха (например, «симуляция делает ≥ 3 шага без ошибок, `p_mean` конечна»).

# Пример проверки (скелет)

```julia
using Test

@testset "reservoir-smoke" begin
    dp = JutulDarcy.GeoEnergyIO.test_input_file_path("EGG", "EGG.DATA")
    case = setup_case_from_data_file(dp)
    case = case[1:3]  # урезаем для скорости
    res = simulate_reservoir(case)
    @test length(res) ≥ 1
    @test isfinite(mean(res[:pressure]))
end
```

# Ограничения и запреты

* Не удалять содержимое файлов и не создавать «новую большую функцию» вместо точечного фикса.
* Не переименовывать публичные API без причины.
* Не использовать «магические» числа — только именованные параметры по месту.
* Не добавлять синтаксический «сахар»/макросы, если эквивалент есть в базовом Julia/JutulDarcy.

# Чек-лист перед отправкой («Check»)

* Код форматируется `JuliaFormatter.jl` без ручных правок.
* Импорты минимальны, без лишних зависимостей.
* Дифф минимален: меняется только то, что связано с задачей.
* Имена на английском в `snake_case`, СИ-единицы.

# Definition of Done

* Минимальный рабочий патч + короткие пояснения + воспроизводимая проверка.
* Решение не усложняет базу
